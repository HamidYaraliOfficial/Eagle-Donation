<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="پلتفرم نوآوری - حمایت مالی برای آینده‌ای بهتر">
    <meta name="author" content="Hamid Yarali">
    <meta name="keywords" content="حمایت مالی, نوآوری, فناوری, دونیت, زرین‌پال">
    <title>پلتفرم نوآوری - Eagle Donation</title>
    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAtUExURUdwTP///3BwcGZmZmtra29vb3V1dXx8fICAgJycnLy8vOjo6P7+/v39/fv7+/Dw8PPz8wAAAARdFJOUwC8/5z/nP+c/5z/nP+c/5z/nAAAAJpJREFUOMt1kUcWwyAMRNES2CKgMff/PzqJQM6dG8wkQ+12d3d2d3d3d3c3Nzf3dw8AALg7O7u7u7u7u7u7u7u7u7u7uwcAALi7u7u7u7u7u7u7u7u7u7u7uwcAALi7u7u7u7u7u7u7u7u7u7u7uwcAALi7u7u7u7u7u7u7u7u7u7u7uwcAALi7u7u7u7u7u7u7u7u7u7u7uwcAAAD//wMA/7k3CwAAAABJRU5ErkJggg==">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #3b82f6;
            --secondary-color: #ef4444;
            --background-gradient: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            --text-color: #ffffff;
            --card-bg: rgba(255, 255, 255, 0.05);
            --card-border: rgba(255, 255, 255, 0.1);
            --input-bg: rgba(255, 255, 255, 0.05);
            --input-border: rgba(255, 255, 255, 0.1);
        }

        [data-theme="light"] {
            --primary-color: #2563eb;
            --secondary-color: #dc2626;
            --background-gradient: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            --text-color: #1f2937;
            --card-bg: rgba(0, 0, 0, 0.05);
            --card-border: rgba(0, 0, 0, 0.1);
            --input-bg: rgba(0, 0, 0, 0.05);
            --input-border: rgba(0, 0, 0, 0.1);
        }

        * {
            font-family: 'Vazirmatn', 'Roboto', 'Noto Sans SC', sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        body {
            background: var(--background-gradient);
            min-height: 100vh;
            color: var(--text-color);
        }
        
        .glass-card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--card-border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .glass-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
            transition: all 0.3s ease;
        }
        
        .gradient-text {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .gradient-button {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            transition: all 0.3s ease;
        }
        
        .gradient-button:hover {
            background: linear-gradient(135deg, #2563eb, #dc2626);
            transform: translateY(-1px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }
        
        .success-button {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .success-button:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-1px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
        }
        
        .amount-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .amount-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.2);
        }
        
        .amount-card.selected {
            background: rgba(59, 130, 246, 0.1);
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
        }
        
        .payment-method-card {
            transition: all 0.3s ease;
        }
        
        .payment-method-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
        }
        
        .payment-method-card.selected {
            background: rgba(59, 130, 246, 0.1);
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
        }
        
        .stats-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(239, 68, 68, 0.1));
        }
        
        .input-field {
            background: var(--input-bg);
            border: 2px solid var(--input-border);
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .supporter-card {
            background: rgba(255, 255, 255, 0.03);
            border-left: 4px solid var(--primary-color);
            transition: all 0.3s ease;
        }
        
        .supporter-card:hover {
            background: rgba(255, 255, 255, 0.06);
            transform: translateX(-4px);
        }
        
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }
        
        .slide-up {
            animation: slideUp 0.4s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .counter-update {
            animation: counterPulse 0.6s ease-in-out;
        }
        
        @keyframes counterPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Language-specific styles */
        [lang="en"] {
            direction: ltr;
            font-family: 'Roboto', sans-serif;
        }

        [lang="zh"] {
            direction: ltr;
            font-family: 'Noto Sans SC', sans-serif;
        }

        /* Theme toggle button */
        .theme-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }

        /* Language selector */
        .language-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
    </style>
</head>
<body data-theme="dark">
    <!-- Theme Toggle -->
    <button id="themeToggle" class="theme-toggle bg-gray-800 text-white p-2 rounded-full">
        🌙
    </button>

    <!-- Language Selector -->
    <select id="languageSelector" class="language-selector bg-gray-800 text-white p-2 rounded-lg">
        <option value="fa">فارسی</option>
        <option value="en">English</option>
        <option value="zh">中文</option>
    </select>

    <!-- Header -->
    <header class="py-8 border-b border-white/10">
        <div class="container mx-auto px-6">
            <div class="flex flex-col lg:flex-row items-center justify-between">
                <div class="flex items-center space-x-6 space-x-reverse mb-6 lg:mb-0">
                    <div class="w-16 h-16 glass-card rounded-2xl flex items-center justify-center">
                        <span class="text-3xl">🚀</span>
                    </div>
                    <div>
                        <h1 class="text-white text-3xl font-bold mb-1" data-translate="platform-title">پلتفرم نوآوری</h1>
                        <p class="text-gray-400" data-translate="platform-subtitle">با حمایت شما، آینده را می‌سازیم</p>
                    </div>
                </div>
                <div class="flex items-center space-x-8 space-x-reverse">
                    <div class="text-center">
                        <div id="headerTotalSupporters" class="text-2xl font-bold text-blue-400">۰</div>
                        <div class="text-sm text-gray-400" data-translate="supporters">حمایت‌کننده</div>
                    </div>
                    <div class="text-center">
                        <div id="headerTotalAmount" class="text-2xl font-bold text-green-400">۰</div>
                        <div class="text-sm text-gray-400" data-translate="currency">تومان</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-6 py-12 max-w-7xl">
        <div class="grid lg:grid-cols-3 gap-8">
            <!-- Main Content -->
            <div class="lg:col-span-2 space-y-8">
                <!-- Hero Section -->
                <div class="glass-card rounded-3xl p-8 text-center slide-up">
                    <div class="w-24 h-24 mx-auto mb-6 glass-card rounded-full flex items-center justify-center">
                        <span class="text-4xl">💎</span>
                    </div>
                    <h2 class="gradient-text text-4xl font-bold mb-4" data-translate="hero-title">
                        آینده را با ما بسازید
                    </h2>
                    <p class="text-gray-300 text-lg leading-relaxed max-w-2xl mx-auto" data-translate="hero-text">
                        هر حمایت شما، قدمی به سوی نوآوری و پیشرفت است. با کمک شما، پروژه‌های فناورانه بزرگی خلق می‌کنیم که زندگی همه را بهتر می‌کند.
                    </p>
                </div>

                <!-- Amount Selection -->
                <div class="glass-card rounded-3xl p-8">
                    <h3 class="text-white text-2xl font-bold mb-8 text-center" data-translate="select-amount">
                        مبلغ حمایت خود را انتخاب کنید
                    </h3>
                    
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="amount-card glass-card rounded-2xl p-6 text-center border-2 border-transparent" onclick="selectAmount(50000)">
                            <div class="text-3xl mb-4">☕</div>
                            <div class="text-white text-xl font-bold">۵۰,۰۰۰</div>
                            <div class="text-gray-400 text-sm mt-2" data-translate="coffee">قهوه‌ای گرم</div>
                        </div>
                        <div class="amount-card glass-card rounded-2xl p-6 text-center border-2 border-transparent" onclick="selectAmount(100000)">
                            <div class="text-3xl mb-4">🍕</div>
                            <div class="text-white text-xl font-bold">۱۰۰,۰۰۰</div>
                            <div class="text-gray-400 text-sm mt-2" data-translate="meal">یک وعده غذا</div>
                        </div>
                        <div class="amount-card glass-card rounded-2xl p-6 text-center border-2 border-transparent" onclick="selectAmount(250000)">
                            <div class="text-3xl mb-4">🎁</div>
                            <div class="text-white text-xl font-bold">۲۵۰,۰۰۰</div>
                            <div class="text-gray-400 text-sm mt-2" data-translate="gift">هدیه ویژه</div>
                        </div>
                        <div class="amount-card glass-card rounded-2xl p-6 text-center border-2 border-transparent" onclick="selectAmount(500000)">
                            <div class="text-3xl mb-4">💎</div>
                            <div class="text-white text-xl font-bold">۵۰۰,۰۰۰</div>
                            <div class="text-gray-400 text-sm mt-2" data-translate="golden">حمایت طلایی</div>
                        </div>
                    </div>

                    <!-- Custom Amount -->
                    <div class="mb-8">
                        <label class="block text-white font-semibold mb-4" data-translate="custom-amount">مبلغ دلخواه</label>
                        <div class="relative">
                            <input type="text" id="customAmount" class="input-field w-full rounded-xl px-6 py-4 text-white text-xl placeholder-gray-400 outline-none" placeholder="مثال: ۱,۰۰۰,۰۰۰" oninput="formatNumber(this)">
                            <span class="absolute left-6 top-1/2 transform -translate-y-1/2 text-gray-400" data-translate="currency">تومان</span>
                        </div>
                    </div>

                    <!-- User Info -->
                    <div class="grid md:grid-cols-2 gap-6 mb-8">
                        <div>
                            <label class="block text-white font-semibold mb-3" data-translate="name">نام شما</label>
                            <input type="text" id="donorName" class="input-field w-full rounded-xl px-4 py-3 text-white placeholder-gray-400 outline-none" placeholder="نام و نام خانوادگی">
                        </div>
                        <div>
                            <label class="block text-white font-semibold mb-3" data-translate="email">ایمیل</label>
                            <input type="email" id="donorEmail" class="input-field w-full rounded-xl px-4 py-3 text-white placeholder-gray-400 outline-none" placeholder="example@email.com">
                        </div>
                    </div>

                    <div class="mb-8">
                        <label class="block text-white font-semibold mb-3" data-translate="message">پیام حمایت</label>
                        <textarea id="donorMessage" rows="4" class="input-field w-full rounded-xl px-4 py-3 text-white placeholder-gray-400 outline-none resize-none" placeholder="پیام انگیزشی خود را بنویسید..."></textarea>
                    </div>

                    <!-- Payment Method Selection -->
                    <div class="mb-6">
                        <label class="block text-white font-semibold mb-4" data-translate="payment-method">روش پرداخت</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="payment-method-card glass-card rounded-xl p-4 border-2 border-transparent cursor-pointer" onclick="selectPaymentMethod('gateway')" id="gatewayMethod">
                                <div class="flex items-center space-x-3 space-x-reverse">
                                    <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-red-600 rounded-full flex items-center justify-center">
                                        <span class="text-white text-xl">💳</span>
                                    </div>
                                    <div>
                                        <div class="text-white font-semibold" data-translate="gateway">درگاه پرداخت</div>
                                        <div class="text-gray-400 text-sm" data-translate="gateway-desc">پرداخت با کارت بانکی</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="payment-method-card glass-card rounded-xl p-4 border-2 border-transparent cursor-pointer" onclick="selectPaymentMethod('direct')" id="directMethod">
                                <div class="flex items-center space-x-3 space-x-reverse">
                                    <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-teal-600 rounded-full flex items-center justify-center">
                                        <span class="text-white text-xl">⚡</span>
                                    </div>
                                    <div>
                                        <div class="text-white font-semibold" data-translate="direct">پرداخت مستقیم</div>
                                        <div class="text-gray-400 text-sm" data-translate="direct-desc">بدون وارد کردن اطلاعات کارت</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Direct Payment Fields (Hidden by default) -->
                    <div id="directPaymentFields" class="hidden mb-6 space-y-4">
                        <div class="bg-blue-500/10 border border-blue-500/20 rounded-xl p-4">
                            <div class="flex items-center space-x-2 space-x-reverse mb-2">
                                <span class="text-blue-400 text-xl">ℹ️</span>
                                <span class="text-blue-400 font-semibold" data-translate="direct-payment">پرداخت مستقیم</span>
                            </div>
                            <p class="text-gray-300 text-sm" data-translate="direct-payment-desc">
                                با پرداخت مستقیم، شما یک قرارداد امن با بانک می‌بندید و در آینده بدون وارد کردن اطلاعات کارت پرداخت خواهید کرد.
                            </p>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-white font-semibold mb-3" data-translate="mobile">شماره موبایل *</label>
                                <input type="tel" id="directMobile" class="input-field w-full rounded-xl px-4 py-3 text-white placeholder-gray-400 outline-none" placeholder="09123456789" maxlength="11">
                            </div>
                            <div>
                                <label class="block text-white font-semibold mb-3" data-translate="ssn">کد ملی (اختیاری)</label>
                                <input type="text" id="directSSN" class="input-field w-full rounded-xl px-4 py-3 text-white placeholder-gray-400 outline-none" placeholder="0123456789" maxlength="10">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-white font-semibold mb-3" data-translate="bank">انتخاب بانک</label>
                            <select id="bankSelect" class="input-field w-full rounded-xl px-4 py-3 text-white bg-gray-800 outline-none">
                                <option value="">در حال بارگذاری بانک‌ها...</option>
                            </select>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-white font-semibold mb-3" data-translate="daily-transaction">حداکثر تراکنش روزانه</label>
                                <input type="number" id="maxDailyCount" class="input-field w-full rounded-xl px-4 py-3 text-white placeholder-gray-400 outline-none" value="10" min="1" max="100">
                            </div>
                            <div>
                                <label class="block text-white font-semibold mb-3" data-translate="monthly-transaction">حداکثر تراکنش ماهانه</label>
                                <input type="number" id="maxMonthlyCount" class="input-field w-full rounded-xl px-4 py-3 text-white placeholder-gray-400 outline-none" value="50" min="1" max="1000">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-white font-semibold mb-3" data-translate="max-amount">حداکثر مبلغ تراکنش (ریال)</label>
                            <input type="text" id="maxAmount" class="input-field w-full rounded-xl px-4 py-3 text-white placeholder-gray-400 outline-none" value="5,000,000" oninput="formatRialNumber(this)">
                        </div>
                    </div>

                    <!-- Action Button -->
                    <div>
                        <button onclick="processPayment()" class="success-button w-full text-white font-bold py-4 px-8 rounded-xl flex items-center justify-center space-x-4 space-x-reverse text-lg" id="paymentButton">
                            <span class="text-2xl">💳</span>
                            <span data-translate="payment-button">پرداخت امن با زرین‌پال</span>
                            <span class="text-sm bg-white/20 px-3 py-1 rounded-full">SSL محافظت شده</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="space-y-6">
                <!-- Goal Progress -->
                <div class="glass-card rounded-3xl p-6">
                    <h3 class="text-white text-xl font-bold mb-6 flex items-center space-x-2 space-x-reverse">
                        <span>🎯</span>
                        <span data-translate="monthly-goal">هدف ماهانه</span>
                    </h3>
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-gray-300" data-translate="progress">پیشرفت:</span>
                            <span id="progressPercent" class="text-blue-400 font-bold">۰%</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-3">
                            <div id="progressBar" class="bg-gradient-to-r from-blue-500 to-red-600 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between items-center mt-2 text-sm">
                            <span id="currentAmount" class="text-green-400">۰ ت</span>
                            <span class="text-gray-400" data-translate="goal">هدف: ۱۰,۰۰۰,۰۰۰ ت</span>
                        </div>
                    </div>
                </div>

                <!-- Statistics -->
                <div class="glass-card rounded-3xl p-6">
                    <h3 class="text-white text-xl font-bold mb-6 flex items-center space-x-2 space-x-reverse">
                        <span>📊</span>
                        <span data-translate="statistics">آمار واقعی</span>
                    </h3>
                    <div class="space-y-4">
                        <div class="stats-card rounded-xl p-4">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-300" data-translate="total-raised">کل جمع‌آوری:</span>
                                <span id="realTotalAmount" class="text-green-400 font-bold text-lg">۰ ت</span>
                            </div>
                        </div>
                        <div class="stats-card rounded-xl p-4">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-300" data-translate="total-supporters">کل حمایت‌کنندگان:</span>
                                <span id="realTotalSupporters" class="text-blue-400 font-bold text-lg">۰ نفر</span>
                            </div>
                        </div>
                        <div class="stats-card rounded-xl p-4">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-300" data-translate="average-donation">میانگین حمایت:</span>
                                <span id="averageAmount" class="text-purple-400 font-bold text-lg">۰ ت</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Live Activity -->
                <div class="glass-card rounded-3xl p-6">
                    <h3 class="text-white text-xl font-bold mb-6 flex items-center space-x-2 space-x-reverse">
                        <span class="w-3 h-3 bg-red-500 rounded-full animate-pulse"></span>
                        <span data-translate="live-activity">فعالیت زنده</span>
                    </h3>
                    <div id="recentSupporters" class="space-y-3">
                        <!-- Dynamic content -->
                    </div>
                </div>

                <!-- Dashboard -->
                <div class="glass-card rounded-3xl p-6">
                    <h3 class="text-white text-xl font-bold mb-6 flex items-center space-x-2 space-x-reverse">
                        <span>📈</span>
                        <span data-translate="dashboard">داشبورد آمار</span>
                    </h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="stats-card rounded-xl p-4 text-center">
                            <div id="todayCount" class="text-2xl font-bold text-blue-400">۰</div>
                            <div class="text-gray-300 text-sm" data-translate="today">امروز</div>
                        </div>
                        <div class="stats-card rounded-xl p-4 text-center">
                            <div id="weekCount" class="text-2xl font-bold text-green-400">۰</div>
                            <div class="text-gray-300 text-sm" data-translate="this-week">این هفته</div>
                        </div>
                        <div class="stats-card rounded-xl p-4 text-center">
                            <div id="monthCount" class="text-2xl font-bold text-yellow-400">۰</div>
                            <div class="text-gray-300 text-sm" data-translate="this-month">این ماه</div>
                        </div>
                        <div class="stats-card rounded-xl p-4 text-center">
                            <div id="totalCount" class="text-2xl font-bold text-pink-400">۰</div>
                            <div class="text-gray-300 text-sm" data-translate="total">کل</div>
                        </div>
                    </div>
                </div>

                <!-- Transaction History (GraphQL) -->
                <div class="glass-card rounded-3xl p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-white text-xl font-bold flex items-center space-x-2 space-x-reverse">
                            <span>📋</span>
                            <span data-translate="transaction-history">تاریخچه تراکنش‌ها</span>
                        </h3>
                        <button onclick="loadTransactionHistory()" class="bg-blue-600 hover:bg-blue-700 text-white text-xs px-3 py-1 rounded-lg transition-all duration-300">
                            <span data-translate="update">بروزرسانی</span>
                        </button>
                    </div>
                    <div id="transactionHistory" class="space-y-3">
                        <div class="text-center py-4">
                            <div class="text-2xl mb-2">📊</div>
                            <div class="text-gray-400 text-sm" data-translate="transaction-placeholder">برای مشاهده تراکنش‌ها، Access Token را تنظیم کنید</div>
                        </div>
                    </div>
                </div>

                <!-- Donation Milestones -->
                <div class="glass-card rounded-3xl p-6">
                    <h3 class="text-white text-xl font-bold mb-6 flex items-center space-x-2 space-x-reverse">
                        <span>🎯</span>
                        <span data-translate="milestones">نشان‌های دونیت</span>
                    </h3>
                    <div class="space-y-3">
                        <div class="stats-card rounded-xl p-3 flex items-center justify-between">
                            <div class="flex items-center space-x-2 space-x-reverse">
                                <span class="text-xl">☕</span>
                                <span class="text-white text-sm" data-translate="coffee-badge">قهوه‌چی</span>
                            </div>
                            <span class="text-gray-400 text-xs">۵۰,۰۰۰ ت</span>
                        </div>
                        <div class="stats-card rounded-xl p-3 flex items-center justify-between">
                            <div class="flex items-center space-x-2 space-x-reverse">
                                <span class="text-xl">🍕</span>
                                <span class="text-white text-sm" data-translate="meal-badge">غذاساز</span>
                            </div>
                            <span class="text-gray-400 text-xs">۱۰۰,۰۰۰ ت</span>
                        </div>
                        <div class="stats-card rounded-xl p-3 flex items-center justify-between">
                            <div class="flex items-center space-x-2 space-x-reverse">
                                <span class="text-xl">🎁</span>
                                <span class="text-white text-sm" data-translate="gift-badge">هدیه‌دهنده</span>
                            </div>
                            <span class="text-gray-400 text-xs">۲۵۰,۰۰۰ ت</span>
                        </div>
                        <div class="stats-card rounded-xl p-3 flex items-center justify-between">
                            <div class="flex items-center space-x-2 space-x-reverse">
                                <span class="text-xl">💎</span>
                                <span class="text-white text-sm" data-translate="diamond-badge">الماسی</span>
                            </div>
                            <span class="text-gray-400 text-xs">۵۰۰,۰۰۰ ت</span>
                        </div>
                        <div class="stats-card rounded-xl p-3 flex items-center justify-between">
                            <div class="flex items-center space-x-2 space-x-reverse">
                                <span class="text-xl">👑</span>
                                <span class="text-white text-sm" data-translate="millionaire-badge">میلیونر</span>
                            </div>
                            <span class="text-gray-400 text-xs">۱,۰۰۰,۰۰۰ ت</span>
                        </div>
                        <div class="stats-card rounded-xl p-3 flex items-center justify-between">
                            <div class="flex items-center space-x-2 space-x-reverse">
                                <span class="text-xl">🚀</span>
                                <span class="text-white text-sm" data-translate="astronaut-badge">فضانورد</span>
                            </div>
                            <span class="text-gray-400 text-xs">۵,۰۰۰,۰۰۰ ت</span>
                        </div>
                    </div>
                </div>

                <!-- User Badges -->
                <div class="glass-card rounded-3xl p-6 text-center">
                    <div class="text-5xl mb-4">🏆</div>
                    <h4 class="text-white text-lg font-bold mb-4" data-translate="earned-badges">نشان‌های کسب شده</h4>
                    <div id="userBadgesList" class="space-y-2">
                        <div class="text-gray-400 text-sm" data-translate="no-badges">هنوز نشانی کسب نکرده‌اید</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="mt-16 border-t border-white/10">
        <div class="container mx-auto px-6 py-12">
            <div class="glass-card rounded-3xl p-8">
                <div class="text-center mb-8">
                    <div class="w-16 h-16 mx-auto mb-4 glass-card rounded-2xl flex items-center justify-center">
                        <span class="text-2xl">💻</span>
                    </div>
                    <h3 class="gradient-text text-2xl font-bold mb-2" data-translate="built-by">ساخته شده با ❤️ توسط Hamid Yarali</h3>
                    <p class="text-gray-400" data-translate="team">توسط تیم توسعه‌دهندگان حرفه‌ای</p>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6 max-w-2xl mx-auto">
                    <!-- Creator -->
                    <a href="https://www.instagram.com/hamidyaraliofficial?igsh=MWpxZjhhMHZuNnlpYQ==" target="_blank" class="glass-card rounded-2xl p-6 text-center hover:scale-105 transition-all duration-300 group">
                        <div class="w-12 h-12 mx-auto mb-4 bg-gradient-to-r from-blue-500 to-red-600 rounded-full flex items-center justify-center">
                            <span class="text-white text-xl">👨‍💻</span>
                        </div>
                        <h4 class="text-white font-bold text-lg mb-2 group-hover:text-blue-400 transition-colors" data-translate="creator">سازنده پروژه</h4>
                        <p class="text-gray-400 text-sm mb-3" data-translate="creator-desc">طراح و توسعه‌دهنده: Hamid Yarali</p>
                        <div class="flex items-center justify-center space-x-2 space-x-reverse text-blue-400">
                            <span class="text-lg">📷</span>
                            <span class="text-sm font-semibold" data-translate="instagram">ارتباط در اینستاگرام</span>
                        </div>
                    </a>
                    
                    <!-- Repository -->
                    <a href="https://github.com/HamidYaraliOfficial" target="_blank" class="glass-card rounded-2xl p-6 text-center hover:scale-105 transition-all duration-300 group">
                        <div class="w-12 h-12 mx-auto mb-4 bg-gradient-to-r from-green-500 to-teal-600 rounded-full flex items-center justify-center">
                            <span class="text-white text-xl">📢</span>
                        </div>
                        <h4 class="text-white font-bold text-lg mb-2 group-hover:text-green-400 transition-colors" data-translate="repo">مخزن پروژه</h4>
                        <p class="text-gray-400 text-sm mb-3" data-translate="repo-desc">سورس کد و مستندات</p>
                        <div class="flex items-center justify-center space-x-2 space-x-reverse text-green-400">
                            <span class="text-lg">🔔</span>
                            <span class="text-sm font-semibold" data-translate="github">مشاهده در گیت‌هاب</span>
                        </div>
                    </a>
                </div>
                
                <div class="text-center mt-8 pt-6 border-t border-white/10">
                    <p class="text-gray-500 text-sm" data-translate="copyright">
                        © ۲۰۲۴ پلتفرم نوآوری • تمامی حقوق محفوظ است
                    </p>
                    <div class="flex items-center justify-center space-x-6 space-x-reverse mt-4">
                        <span class="text-gray-600 text-xs" data-translate="made-with">ساخته شده با</span>
                        <span class="text-red-400 text-sm">❤️</span>
                        <span class="text-gray-600 text-xs" data-translate="and">و</span>
                        <span class="text-blue-400 text-xs font-semibold" data-translate="technology">تکنولوژی پیشرفته</span>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Payment Gateway Modal -->
    <div id="paymentGatewayModal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
        <div class="glass-card rounded-3xl p-8 max-w-lg mx-4 slide-up">
            <div class="text-center mb-6">
                <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-green-500 to-blue-600 rounded-full flex items-center justify-center">
                    <span class="text-white text-2xl">💳</span>
                </div>
                <h3 class="text-white text-2xl font-bold mb-2" data-translate="gateway-title">درگاه پرداخت زرین‌پال</h3>
                <p class="text-gray-400" data-translate="gateway-desc">پرداخت امن و مطمئن</p>
            </div>
            
            <div class="bg-white/5 rounded-2xl p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-gray-300" data-translate="payable-amount">مبلغ قابل پرداخت:</span>
                    <span id="gatewayAmount" class="text-green-400 font-bold text-xl">۰ تومان</span>
                </div>
                <div class="flex justify-between items-center mb-4">
                    <span class="text-gray-300" data-translate="payer-name">نام پرداخت‌کننده:</span>
                    <span id="gatewayName" class="text-white font-semibold">-</span>
                </div>
                <div class="text-center">
                    <div class="text-sm text-gray-400 mb-4" data-translate="tracking-code">کد پیگیری: #ZP-<span id="trackingCode">000000</span></div>
                </div>
            </div>
            
            <div class="space-y-4">
                <button onclick="completePayment()" class="success-button w-full text-white font-bold py-4 px-6 rounded-xl flex items-center justify-center space-x-3 space-x-reverse">
                    <span class="text-xl">✅</span>
                    <span data-translate="complete-payment">تکمیل پرداخت</span>
                </button>
                
                <button onclick="cancelPayment()" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300">
                    <span data-translate="cancel-payment">انصراف از پرداخت</span>
                </button>
            </div>
            
            <div class="text-center mt-6">
                <div class="flex items-center justify-center space-x-2 space-x-reverse text-green-400 text-sm">
                    <span>🔒</span>
                    <span data-translate="secure-connection">اتصال امن SSL</span>
                    <span>•</span>
                    <span data-translate="protected">محافظت شده توسط زرین‌پال</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Error Modal -->
    <div id="errorModal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
        <div class="glass-card rounded-3xl p-8 max-w-md mx-4 text-center slide-up">
            <div class="w-20 h-20 mx-auto mb-6 bg-red-600 rounded-full flex items-center justify-center">
                <span class="text-white text-4xl">❌</span>
            </div>
            <h3 class="text-red-400 text-2xl font-bold mb-4" id="errorTitle" data-translate="error-title">
                خطا رخ داده است
            </h3>
            <p class="text-gray-300 mb-8" id="errorMessage">متن خطا</p>
            <button onclick="closeErrorModal()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-xl transition-all duration-300">
                <span data-translate="understood">متوجه شدم</span>
            </button>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
        <div class="glass-card rounded-3xl p-8 max-w-md mx-4 text-center slide-up">
            <div class="w-20 h-20 mx-auto mb-6 glass-card rounded-full flex items-center justify-center">
                <span class="text-4xl">🎉</span>
            </div>
            <h3 class="gradient-text text-3xl font-bold mb-4" data-translate="success-title">
                حمایت شما ثبت شد!
            </h3>
            <p class="text-gray-300 mb-8" data-translate="success-message">از حمایت ارزشمند شما صمیمانه تشکر می‌کنیم</p>
            <button onclick="closeSuccessModal()" class="gradient-button text-white font-bold py-3 px-8 rounded-xl">
                <span data-translate="great">عالی!</span>
            </button>
        </div>
    </div>

    <!-- Direct Payment Success Modal -->
    <div id="directPaymentSuccessModal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
        <div class="glass-card rounded-3xl p-8 max-w-lg mx-4 text-center slide-up">
            <div class="w-20 h-20 mx-auto mb-6 glass-card rounded-full flex items-center justify-center">
                <span class="text-4xl">⚡</span>
            </div>
            <h3 class="gradient-text text-3xl font-bold mb-4" data-translate="direct-success-title">
                قرارداد پرداخت مستقیم ایجاد شد!
            </h3>
            <p class="text-gray-300 mb-6" data-translate="direct-success-message">قرارداد شما با موفقیت ثبت شد</p>
            
            <div class="bg-white/5 rounded-xl p-6 mb-6 space-y-4 text-left">
                <div class="text-center border-b border-white/10 pb-4">
                    <div class="text-sm text-gray-400 mb-1" data-translate="contract-id">شناسه قرارداد</div>
                    <div class="text-green-400 font-bold text-lg" id="contractAuthority">-</div>
                </div>
                
                <div class="space-y-3 text-sm">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400" data-translate="mobile">شماره موبایل:</span>
                        <span class="text-white" id="contractMobile">-</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400" data-translate="bank">بانک انتخابی:</span>
                        <span class="text-blue-400" id="contractBank">-</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400" data-translate="max-amount">حداکثر مبلغ:</span>
                        <span class="text-yellow-400" id="contractMaxAmount">-</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400" data-translate="daily-transaction">تراکنش روزانه:</span>
                        <span class="text-purple-400" id="contractDailyCount">-</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400" data-translate="status">وضعیت:</span>
                        <span class="text-green-400 font-semibold" data-translate="active">✅ فعال</span>
                    </div>
                </div>
            </div>
            
            <div class="text-center mb-6">
                <div class="text-xs text-gray-500 mb-2" data-translate="secure-storage">
                    🔒 قرارداد شما امن و محرمانه ذخیره شده است
                </div>
                <div class="text-xs text-gray-500" data-translate="sms-confirmation">
                    📱 پیامک تایید به شماره موبایل شما ارسال خواهد شد
                </div>
            </div>
            
            <button onclick="closeDirectPaymentSuccessModal()" class="gradient-button text-white font-bold py-3 px-8 rounded-xl">
                <span data-translate="great">عالی!</span>
            </button>
        </div>
    </div>

    <!-- Welcome Modal -->
    <div id="welcomeModal" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50">
        <div class="glass-card rounded-3xl p-12 max-w-2xl mx-4 text-center slide-up">
            <div class="w-32 h-32 mx-auto mb-8 glass-card rounded-full flex items-center justify-center">
                <span class="text-6xl">🚀</span>
            </div>
            
            <h1 class="gradient-text text-4xl font-bold mb-6" data-translate="welcome-title">
                به پلتفرم نوآوری خوش آمدید!
            </h1>
            
            <div class="space-y-4 mb-8 text-lg text-gray-300">
                <p data-translate="welcome-text-1">🌟 شما وارد دنیای نوآوری و فناوری شده‌اید</p>
                <p data-translate="welcome-text-2">💎 هر حمایت شما، قدمی به سوی آینده بهتر است</p>
                <p data-translate="welcome-text-3">🎯 آماده تجربه‌ای فوق‌العاده هستید؟</p>
            </div>
            
            <button onclick="closeWelcomeModal()" class="gradient-button text-white font-bold py-4 px-8 rounded-xl text-xl">
                <span data-translate="lets-go">🎉 بزن بریم!</span>
            </button>
        </div>
    </div>

    <script>
        let selectedAmount = 0;
        let selectedPaymentMethod = 'gateway'; // Default to gateway payment
        let availableBanks = [];
        
        // ZarinPal Configuration - Will be loaded from localStorage
        let ZARINPAL_ACCESS_TOKEN = 'YOUR_ACCESS_TOKEN_HERE'; // توکن دسترسی از پنل زرین‌پال
        let ZARINPAL_MERCHANT_ID = 'YOUR_ZARINPAL_MERCHANT_ID_HERE'; // مثال: 'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx'
        let ZARINPAL_TERMINAL_ID = 'YOUR_TERMINAL_ID_HERE'; // شماره ترمینال برای مشاهده تراکنش‌ها
        const ZARINPAL_CALLBACK_URL = window.location.origin + '/verify'; // آدرس بازگشت پس از پرداخت
        const ZARINPAL_GRAPHQL_URL = 'https://next.zarinpal.com/api/v4/graphql';
        
        // Direct Payment API URLs
        const ZARINPAL_PAYMAN_REQUEST_URL = 'https://api.zarinpal.com/pg/v4/payman/request.json';
        const ZARINPAL_BANKS_LIST_URL = 'https://api.zarinpal.com/pg/v4/payman/banksList.json';
        
        // Telegram Notification Configuration
        const TELEGRAM_BOT_TOKEN = 'YOUR_BOT_TOKEN_HERE';
        const TELEGRAM_CHAT_ID = 'YOUR_CHAT_ID_HERE';
        
        // Advanced Security Features
        const SecurityManager = {
            // Rate limiting
            rateLimiter: {
                attempts: 0,
                lastAttempt: 0,
                maxAttempts: 5,
                cooldownTime: 300000 // 5 minutes
            },
            
            // Input validation and sanitization
            sanitizeInput: function(input) {
                if (typeof input !== 'string') return '';
                return input.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '')
                           .replace(/javascript:/gi, '')
                           .replace(/on\w+\s*=/gi, '')
                           .trim();
            },
            
            // XSS Protection
            escapeHtml: function(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            },
            
            // CSRF Protection
            generateToken: function() {
                return Math.random().toString(36).substring(2) + Date.now().toString(36);
            },
            
            // Rate limiting check
            checkRateLimit: function() {
                const now = Date.now();
                if (now - this.rateLimiter.lastAttempt > this.rateLimiter.cooldownTime) {
                    this.rateLimiter.attempts = 0;
                }
                
                if (this.rateLimiter.attempts >= this.rateLimiter.maxAttempts) {
                    const remainingTime = Math.ceil((this.rateLimiter.cooldownTime - (now - this.rateLimiter.lastAttempt)) / 1000);
                    throw new Error(translations[currentLang]['rate-limit-error'].replace('{seconds}', remainingTime));
                }
                
                this.rateLimiter.attempts++;
                this.rateLimiter.lastAttempt = now;
                return true;
            },
            
            // Validate amount
            validateAmount: function(amount) {
                if (!amount || isNaN(amount) || amount < 1000 || amount > 100000000) {
                    throw new Error(translations[currentLang]['invalid-amount']);
                }
                return true;
            },
            
            // Validate email
            validateEmail: function(email) {
                if (!email) return true; // Email is optional
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    throw new Error(translations[currentLang]['invalid-email']);
                }
                return true;
            },
            
            // Validate name
            validateName: function(name) {
                if (!name) return true; // Name is optional
                if (name.length > 50) {
                    throw new Error(translations[currentLang]['name-too-long']);
                }
                return true;
            },
            
            // Validate message
            validateMessage: function(message) {
                if (!message) return true; // Message is optional
                if (message.length > 500) {
                    throw new Error(translations[currentLang]['message-too-long']);
                }
                return true;
            }
        };
        
        // Session token for CSRF protection
        const sessionToken = SecurityManager.generateToken();
        
        // Translations
        const translations = {
            fa: {
                'platform-title': 'پلتفرم نوآوری',
                'platform-subtitle': 'با حمایت شما، آینده را می‌سازیم',
                'supporters': 'حمایت‌کننده',
                'currency': 'تومان',
                'hero-title': 'آینده را با ما بسازید',
                'hero-text': 'هر حمایت شما، قدمی به سوی نوآوری و پیشرفت است. با کمک شما، پروژه‌های فناورانه بزرگی خلق می‌کنیم که زندگی همه را بهتر می‌کند.',
                'select-amount': 'مبلغ حمایت خود را انتخاب کنید',
                'coffee': 'قهوه‌ای گرم',
                'meal': 'یک وعده غذا',
                'gift': 'هدیه ویژه',
                'golden': 'حمایت طلایی',
                'custom-amount': 'مبلغ دلخواه',
                'name': 'نام شما',
                'email': 'ایمیل',
                'message': 'پیام حمایت',
                'payment-method': 'روش پرداخت',
                'gateway': 'درگاه پرداخت',
                'gateway-desc': 'پرداخت با کارت بانکی',
                'direct': 'پرداخت مستقیم',
                'direct-desc': 'بدون وارد کردن اطلاعات کارت',
                'direct-payment': 'پرداخت مستقیم',
                'direct-payment-desc': 'با پرداخت مستقیم، شما یک قرارداد امن با بانک می‌بندید و در آینده بدون وارد کردن اطلاعات کارت پرداخت خواهید کرد.',
                'mobile': 'شماره موبایل *',
                'ssn': 'کد ملی (اختیاری)',
                'bank': 'انتخاب بانک',
                'daily-transaction': 'حداکثر تراکنش روزانه',
                'monthly-transaction': 'حداکثر تراکنش ماهانه',
                'max-amount': 'حداکثر مبلغ تراکنش (ریال)',
                'payment-button': 'پرداخت امن با زرین‌پال',
                'monthly-goal': 'هدف ماهانه',
                'progress': 'پیشرفت',
                'goal': 'هدف: ۱۰,۰۰۰,۰۰۰ ت',
                'statistics': 'آمار واقعی',
                'total-raised': 'کل جمع‌آوری:',
                'total-supporters': 'کل حمایت‌کنندگان:',
                'average-donation': 'میانگین حمایت:',
                'live-activity': 'فعالیت زنده',
                'dashboard': 'داشبورد آمار',
                'today': 'امروز',
                'this-week': 'این هفته',
                'this-month': 'این ماه',
                'total': 'کل',
                'transaction-history': 'تاریخچه تراکنش‌ها',
                'update': 'بروزرسانی',
                'transaction-placeholder': 'برای مشاهده تراکنش‌ها، Access Token را تنظیم کنید',
                'milestones': 'نشان‌های دونیت',
                'coffee-badge': 'قهوه‌چی',
                'meal-badge': 'غذاساز',
                'gift-badge': 'هدیه‌دهنده',
                'diamond-badge': 'الماسی',
                'millionaire-badge': 'میلیونر',
                'astronaut-badge': 'فضانورد',
                'earned-badges': 'نشان‌های کسب شده',
                'no-badges': 'هنوز نشانی کسب نکرده‌اید',
                'built-by': 'ساخته شده با ❤️ توسط Hamid Yarali',
                'team': 'توسط تیم توسعه‌دهندگان حرفه‌ای',
                'creator': 'سازنده پروژه',
                'creator-desc': 'طراح و توسعه‌دهنده: Hamid Yarali',
                'instagram': 'ارتباط در اینستاگرام',
                'repo': 'مخزن پروژه',
                'repo-desc': 'سورس کد و مستندات',
                'github': 'مشاهده در گیت‌هاب',
                'copyright': '© ۲۰۲۴ پلتفرم نوآوری • تمامی حقوق محفوظ است',
                'made-with': 'ساخته شده با',
                'and': 'و',
                'technology': 'تکنولوژی پیشرفته',
                'gateway-title': 'درگاه پرداخت زرین‌پال',
                'gateway-desc': 'پرداخت امن و مطمئن',
                'payable-amount': 'مبلغ قابل پرداخت:',
                'payer-name': 'نام پرداخت‌کننده:',
                'tracking-code': 'کد پیگیری: #ZP-',
                'complete-payment': 'تکمیل پرداخت',
                'cancel-payment': 'انصراف از پرداخت',
                'secure-connection': 'اتصال امن SSL',
                'protected': 'محافظت شده توسط زرین‌پال',
                'error-title': 'خطا رخ داده است',
                'understood': 'متوجه شدم',
                'success-title': 'حمایت شما ثبت شد!',
                'success-message': 'از حمایت ارزشمند شما صمیمانه تشکر می‌کنیم',
                'great': 'عالی!',
                'direct-success-title': 'قرارداد پرداخت مستقیم ایجاد شد!',
                'direct-success-message': 'قرارداد شما با موفقیت ثبت شد',
                'contract-id': 'شناسه قرارداد',
                'status': 'وضعیت:',
                'active': '✅ فعال',
                'secure-storage': '🔒 قرارداد شما امن و محرمانه ذخیره شده است',
                'sms-confirmation': '📱 پیامک تایید به شماره موبایل شما ارسال خواهد شد',
                'welcome-title': 'به پلتفرم نوآوری خوش آمدید!',
                'welcome-text-1': '🌟 شما وارد دنیای نوآوری و فناوری شده‌اید',
                'welcome-text-2': '💎 هر حمایت شما، قدمی به سوی آینده بهتر است',
                'welcome-text-3': '🎯 آماده تجربه‌ای فوق‌العاده هستید؟',
                'lets-go': '🎉 بزن بریم!',
                'rate-limit-error': 'تعداد تلاش‌های شما بیش از حد مجاز است. لطفاً {seconds} ثانیه صبر کنید.',
                'invalid-amount': 'مبلغ وارد شده معتبر نیست',
                'invalid-email': 'فرمت ایمیل صحیح نیست',
                'name-too-long': 'نام نباید بیش از ۵۰ کاراکتر باشد',
                'message-too-long': 'پیام نباید بیش از ۵۰۰ کاراکتر باشد'
            },
            en: {
                'platform-title': 'Innovation Platform',
                'platform-subtitle': 'With your support, we build the future',
                'supporters': 'Supporters',
                'currency': 'Toman',
                'hero-title': 'Build the Future with Us',
                'hero-text': 'Every support you provide is a step towards innovation and progress. With your help, we create major technological projects that improve everyone\'s life.',
                'select-amount': 'Select Your Donation Amount',
                'coffee': 'Warm Coffee',
                'meal': 'One Meal',
                'gift': 'Special Gift',
                'golden': 'Golden Support',
                'custom-amount': 'Custom Amount',
                'name': 'Your Name',
                'email': 'Email',
                'message': 'Support Message',
                'payment-method': 'Payment Method',
                'gateway': 'Payment Gateway',
                'gateway-desc': 'Pay with Bank Card',
                'direct': 'Direct Payment',
                'direct-desc': 'Without Entering Card Details',
                'direct-payment': 'Direct Payment',
                'direct-payment-desc': 'With direct payment, you enter a secure contract with the bank and can pay in the future without entering card details.',
                'mobile': 'Mobile Number *',
                'ssn': 'National ID (Optional)',
                'bank': 'Select Bank',
                'daily-transaction': 'Maximum Daily Transactions',
                'monthly-transaction': 'Maximum Monthly Transactions',
                'max-amount': 'Maximum Transaction Amount (Rial)',
                'payment-button': 'Secure Payment with ZarinPal',
                'monthly-goal': 'Monthly Goal',
                'progress': 'Progress:',
                'goal': 'Goal: 10,000,000 T',
                'statistics': 'Real Statistics',
                'total-raised': 'Total Raised:',
                'total-supporters': 'Total Supporters:',
                'average-donation': 'Average Donation:',
                'live-activity': 'Live Activity',
                'dashboard': 'Statistics Dashboard',
                'today': 'Today',
                'this-week': 'This Week',
                'this-month': 'This Month',
                'total': 'Total',
                'transaction-history': 'Transaction History',
                'update': 'Update',
                'transaction-placeholder': 'Set Access Token to view transactions',
                'milestones': 'Donation Milestones',
                'coffee-badge': 'Coffee Maker',
                'meal-badge': 'Meal Provider',
                'gift-badge': 'Gift Giver',
                'diamond-badge': 'Diamond',
                'millionaire-badge': 'Millionaire',
                'astronaut-badge': 'Astronaut',
                'earned-badges': 'Earned Badges',
                'no-badges': 'You haven’t earned any badges yet',
                'built-by': 'Built with ❤️ by Hamid Yarali',
                'team': 'By a team of professional developers',
                'creator': 'Project Creator',
                'creator-desc': 'Designer and Developer: Hamid Yarali',
                'instagram': 'Connect on Instagram',
                'repo': 'Project Repository',
                'repo-desc': 'Source code and documentation',
                'github': 'View on GitHub',
                'copyright': '© 2024 Innovation Platform • All rights reserved',
                'made-with': 'Made with',
                'and': 'and',
                'technology': 'Advanced Technology',
                'gateway-title': 'ZarinPal Payment Gateway',
                'gateway-desc': 'Secure and Reliable Payment',
                'payable-amount': 'Payable Amount:',
                'payer-name': 'Payer Name:',
                'tracking-code': 'Tracking Code: #ZP-',
                'complete-payment': 'Complete Payment',
                'cancel-payment': 'Cancel Payment',
                'secure-connection': 'Secure SSL Connection',
                'protected': 'Protected by ZarinPal',
                'error-title': 'An Error Occurred',
                'understood': 'Understood',
                'success-title': 'Your Support Was Recorded!',
                'success-message': 'We sincerely thank you for your valuable support',
                'great': 'Great!',
                'direct-success-title': 'Direct Payment Contract Created!',
                'direct-success-message': 'Your contract was successfully registered',
                'contract-id': 'Contract ID',
                'status': 'Status:',
                'active': '✅ Active',
                'secure-storage': '🔒 Your contract is securely and confidentially stored',
                'sms-confirmation': '📱 A confirmation SMS will be sent to your mobile number',
                'welcome-title': 'Welcome to the Innovation Platform!',
                'welcome-text-1': '🌟 You’ve entered the world of innovation and technology',
                'welcome-text-2': '💎 Every support you provide is a step towards a better future',
                'welcome-text-3': '🎯 Ready for an extraordinary experience?',
                'lets-go': '🎉 Let’s Go!',
                'rate-limit-error': 'Too many attempts. Please wait {seconds} seconds.',
                'invalid-amount': 'The entered amount is not valid',
                'invalid-email': 'Email format is incorrect',
                'name-too-long': 'Name must not exceed 50 characters',
                'message-too-long': 'Message must not exceed 500 characters'
            },
            zh: {
                'platform-title': '创新平台',
                'platform-subtitle': '有了您的支持，我们共同构建未来',
                'supporters': '支持者',
                'currency': '托曼',
                'hero-title': '与我们一起构建未来',
                'hero-text': '您的每一次支持都是迈向创新和进步的一步。在您的帮助下，我们将创造改善每个人生活的重大技术项目。',
                'select-amount': '选择您的捐款金额',
                'coffee': '一杯热咖啡',
                'meal': '一顿饭',
                'gift': '特别礼物',
                'golden': '黄金支持',
                'custom-amount': '自定义金额',
                'name': '您的姓名',
                'email': '电子邮件',
                'message': '支持信息',
                'payment-method': '支付方式',
                'gateway': '支付网关',
                'gateway-desc': '使用银行卡支付',
                'direct': '直接支付',
                'direct-desc': '无需输入卡信息',
                'direct-payment': '直接支付',
                'direct-payment-desc': '通过直接支付，您将与银行签订安全合同，未来无需输入卡信息即可支付。',
                'mobile': '手机号码 *',
                'ssn': '身份证号（可选）',
                'bank': '选择银行',
                'daily-transaction': '每日最大交易数',
                'monthly-transaction': '每月最大交易数',
                'max-amount': '最大交易金额（里亚尔）',
                'payment-button': '通过ZarinPal安全支付',
                'monthly-goal': '月度目标',
                'progress': '进度：',
                'goal': '目标：10,000,000 托曼',
                'statistics': '真实统计',
                'total-raised': '总计筹集：',
                'total-supporters': '总支持者：',
                'average-donation': '平均捐款：',
                'live-activity': '实时活动',
                'dashboard': '统计仪表板',
                'today': '今天',
                'this-week': '本周',
                'this-month': '本月',
                'total': '总计',
                'transaction-history': '交易历史',
                'update': '更新',
                'transaction-placeholder': '设置Access Token以查看交易',
                'milestones': '捐款里程碑',
                'coffee-badge': '咖啡制造者',
                'meal-badge': '餐饮提供者',
                'gift-badge': '礼物赠送者',
                'diamond-badge': '钻石',
                'millionaire-badge': '百万富翁',
                'astronaut-badge': '宇航员',
                'earned-badges': '获得的徽章',
                'no-badges': '您尚未获得任何徽章',
                'built-by': '由Hamid Yarali用❤️构建',
                'team': '由专业开发团队打造',
                'creator': '项目创建者',
                'creator-desc': '设计师与开发者：Hamid Yarali',
                'instagram': '在Instagram上联系',
                'repo': '项目仓库',
                'repo-desc': '源代码和文档',
                'github': '在GitHub上查看',
                'copyright': '© 2024 创新平台 • 保留所有权利',
                'made-with': '使用',
                'and': '和',
                'technology': '先进技术',
                'gateway-title': 'ZarinPal支付网关',
                'gateway-desc': '安全可靠的支付',
                'payable-amount': '应付金额：',
                'payer-name': '付款人姓名：',
                'tracking-code': '跟踪代码：#ZP-',
                'complete-payment': '完成支付',
                'cancel-payment': '取消支付',
                'secure-connection': '安全SSL连接',
                'protected': '由ZarinPal保护',
                'error-title': '发生错误',
                'understood': '明白',
                'success-title': '您的支持已记录！',
                'success-message': '我们衷心感谢您的宝贵支持',
                'great': '太好了！',
                'direct-success-title': '直接支付合同已创建！',
                'direct-success-message': '您的合同已成功注册',
                'contract-id': '合同ID',
                'status': '状态：',
                'active': '✅ 活跃',
                'secure-storage': '🔒 您的合同已安全且保密地存储',
                'sms-confirmation': '📱 确认短信将发送到您的手机号码',
                'welcome-title': '欢迎体验创新平台！',
                'welcome-text-1': '🌟 您已进入创新与技术的世界',
                'welcome-text-2': '💎 您的每一次支持都是迈向更美好未来的一步',
                'welcome-text-3': '🎯 准备好迎接非凡体验了吗？',
                'lets-go': '🎉 开始吧！',
                'rate-limit-error': '尝试次数过多。请等待{seconds}秒。',
                'invalid-amount': '输入的金额无效',
                'invalid-email': '电子邮件格式不正确',
                'name-too-long': '姓名不得超过50个字符',
                'message-too-long': '消息不得超过500个字符'
            }
        };

        let currentLang = 'fa';

        // Theme Toggle
        document.getElementById('themeToggle').addEventListener('click', function() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            body.setAttribute('data-theme', currentTheme === 'dark' ? 'light' : 'dark');
            this.textContent = currentTheme === 'dark' ? '☀️' : '🌙';
        });

        // Language Switcher
        document.getElementById('languageSelector').addEventListener('change', function() {
            currentLang = this.value;
            document.documentElement.lang = currentLang;
            document.documentElement.dir = currentLang === 'fa' ? 'rtl' : 'ltr';
            updateTranslations();
        });

        function updateTranslations() {
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                element.textContent = translations[currentLang][key] || element.textContent;
            });
        }

        // ZarinPal Configuration Management
        function loadZarinPalConfig() {
            const savedConfig = DataManager.loadData('zarinpal_config', {});
            
            if (savedConfig.merchant_id) {
                ZARINPAL_MERCHANT_ID = savedConfig.merchant_id;
                document.getElementById('merchantIdInput').value = savedConfig.merchant_id;
                console.log('✅ Merchant ID loaded from storage');
            }
            
            if (savedConfig.access_token) {
                ZARINPAL_ACCESS_TOKEN = savedConfig.access_token;
                document.getElementById('accessTokenInput').value = savedConfig.access_token;
                console.log('✅ Access Token loaded from storage');
            }
            
            // Update configuration status
            updateConfigStatus();
        }
        
        function saveZarinPalConfig() {
            const merchantId = document.getElementById('merchantIdInput').value.trim();
            const accessToken = document.getElementById('accessTokenInput').value.trim();
            
            // Validate Merchant ID format
            if (merchantId && !isValidMerchantId(merchantId)) {
                showConfigStatus('error', translations[currentLang]['invalid-merchant-id']);
                return;
            }
            
            // Validate Access Token format
            if (accessToken && !isValidAccessToken(accessToken)) {
                showConfigStatus('error', translations[currentLang]['invalid-access-token']);
                return;
            }
            
            // Save configuration
            const config = {};
            
            if (merchantId) {
                config.merchant_id = merchantId;
                ZARINPAL_MERCHANT_ID = merchantId;
            }
            
            if (accessToken) {
                config.access_token = accessToken;
                ZARINPAL_ACCESS_TOKEN = accessToken;
            }
            
            DataManager.saveData('zarinpal_config', config);
            
            showConfigStatus('success', translations[currentLang]['config-saved']);
            
            // Update configuration status
            updateConfigStatus();
            
            // Reload transaction history if access token was added
            if (accessToken && accessToken !== 'YOUR_ACCESS_TOKEN_HERE') {
                setTimeout(() => {
                    loadTransactionHistory();
                }, 1000);
            }
            
            console.log('💾 ZarinPal configuration saved successfully');
        }
        
        async function testZarinPalConnection() {
            const merchantId = document.getElementById('merchantIdInput').value.trim();
            const accessToken = document.getElementById('accessTokenInput').value.trim();
            
            if (!merchantId) {
                showConfigStatus('error', translations[currentLang]['merchant-id-required']);
                return;
            }
            
            showConfigStatus('loading', translations[currentLang]['testing-connection']);
            
            try {
                // Test with a small payment request (will not be processed)
                const testData = {
                    merchant_id: merchantId,
                    amount: 1000, // 1000 Toman
                    callback_url: ZARINPAL_CALLBACK_URL,
                    description: translations[currentLang]['test-connection']
                };
                
                const response = await fetch('https://api.zarinpal.com/pg/v4/payment/request.json', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });
                
                const result = await response.json();
                
                if (result.data && result.data.code === 100) {
                    showConfigStatus('success', translations[currentLang]['connection-success']);
                    
                    // Test GraphQL if access token is provided
                    if (accessToken && accessToken !== 'YOUR_ACCESS_TOKEN_HERE') {
                        try {
                            const tempToken = ZARINPAL_ACCESS_TOKEN;
                            ZARINPAL_ACCESS_TOKEN = accessToken;
                            
                            const appInfo = await getApplicationInfo();
                            
                            if (appInfo) {
                                showConfigStatus('success', translations[currentLang]['full-connection-success']);
                            } else {
                                showConfigStatus('warning', translations[currentLang]['access-token-error']);
                            }
                            
                            ZARINPAL_ACCESS_TOKEN = tempToken;
                            
                        } catch (graphqlError) {
                            showConfigStatus('warning', translations[currentLang]['access-token-error']);
                        }
                    }
                    
                } else {
                    const errorMsg = getZarinPalErrorMessage(result.errors?.code || result.data?.code);
                    showConfigStatus('error', `${translations[currentLang]['error']}: ${errorMsg}`);
                }
                
            } catch (error) {
                console.error('Connection test failed:', error);
                showConfigStatus('error', translations[currentLang]['connection-error']);
            }
        }
        
        function isValidMerchantId(merchantId) {
            // ZarinPal Merchant ID format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx (36 characters with dashes)
            const merchantIdRegex = /^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/i;
            return merchantIdRegex.test(merchantId);
        }
        
        function isValidAccessToken(accessToken) {
            // ZarinPal Access Token format: zp-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
            return accessToken.startsWith('zp-') && accessToken.length > 10;
        }
        
        function showConfigStatus(type, message) {
            const statusDiv = document.getElementById('configStatus');
            statusDiv.classList.remove('hidden');
            
            let bgColor, textColor, icon;
            
            switch (type) {
                case 'success':
                    bgColor = 'bg-green-500/20';
                    textColor = 'text-green-400';
                    icon = '✅';
                    break;
                case 'error':
                    bgColor = 'bg-red-500/20';
                    textColor = 'text-red-400';
                    icon = '❌';
                    break;
                case 'warning':
                    bgColor = 'bg-yellow-500/20';
                    textColor = 'text-yellow-400';
                    icon = '⚠️';
                    break;
                case 'loading':
                    bgColor = 'bg-blue-500/20';
                    textColor = 'text-blue-400';
                    icon = '⏳';
                    break;
                default:
                    bgColor = 'bg-gray-500/20';
                    textColor = 'text-gray-400';
                    icon = 'ℹ️';
            }
            
            statusDiv.className = `${bgColor} border border-white/10 rounded-xl p-4 flex items-center space-x-2 space-x-reverse`;
            statusDiv.innerHTML = `
                <span class="text-lg">${icon}</span>
                <span class="${textColor} text-sm font-semibold">${message}</span>
            `;
            
            // Auto hide success/error messages after 5 seconds
            if (type !== 'loading') {
                setTimeout(() => {
                    statusDiv.classList.add('hidden');
                }, 5000);
            }
        }
        
        function updateConfigStatus() {
        const hasMerchantId = ZARINPAL_MERCHANT_ID !== 'YOUR_ZARINPAL_MERCHANT_ID_HERE';
        const hasAccessToken = ZARINPAL_ACCESS_TOKEN !== 'YOUR_ACCESS_TOKEN_HERE';
        
        const statusDiv = document.getElementById('configStatus');
        let statusMessage = '';
        let statusType = 'info';
        
        if (hasMerchantId && hasAccessToken) {
            statusMessage = translations[currentLang]['full-connection-success'];
            statusType = 'success';
        } else if (hasMerchantId) {
            statusMessage = translations[currentLang]['merchant-id-configured'];
            statusType = 'success';
        } else if (hasAccessToken) {
            statusMessage = translations[currentLang]['access-token-configured'];
            statusType = 'success';
        } else {
            statusMessage = translations[currentLang]['no-config'];
            statusType = 'warning';
        }
        
        showConfigStatus(statusType, statusMessage);
    }

    // Data Management
    const DataManager = {
        saveData: function(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
                return true;
            } catch (e) {
                console.error('Failed to save data:', e);
                return false;
            }
        },
        
        loadData: function(key, defaultValue) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : defaultValue;
            } catch (e) {
                console.error('Failed to load data:', e);
                return defaultValue;
            }
        },
        
        clearData: function(key) {
            try {
                localStorage.removeItem(key);
                return true;
            } catch (e) {
                console.error('Failed to clear data:', e);
                return false;
            }
        }
    };

    // Format number input
    function formatNumber(input) {
        let value = input.value.replace(/[^\d]/g, '');
        if (value) {
            value = parseInt(value).toLocaleString('fa-IR');
        }
        input.value = value;
        selectedAmount = parseInt(value.replace(/,/g, '')) || 0;
    }

    function formatRialNumber(input) {
        let value = input.value.replace(/[^\d]/g, '');
        if (value) {
            value = parseInt(value).toLocaleString('fa-IR');
        }
        input.value = value;
    }

    // Amount selection
    function selectAmount(amount) {
        selectedAmount = amount;
        document.querySelectorAll('.amount-card').forEach(card => {
            card.classList.remove('selected');
        });
        event.currentTarget.classList.add('selected');
        document.getElementById('customAmount').value = amount.toLocaleString('fa-IR');
    }

    // Payment method selection
    function selectPaymentMethod(method) {
        selectedPaymentMethod = method;
        document.querySelectorAll('.payment-method-card').forEach(card => {
            card.classList.remove('selected');
        });
        document.getElementById(`${method}Method`).classList.add('selected');
        
        const directFields = document.getElementById('directPaymentFields');
        if (method === 'direct') {
            directFields.classList.remove('hidden');
        } else {
            directFields.classList.add('hidden');
        }
    }

    // Modal controls
    function closeWelcomeModal() {
        document.getElementById('welcomeModal').classList.add('hidden');
    }

    function closeErrorModal() {
        document.getElementById('errorModal').classList.add('hidden');
    }

    function closeSuccessModal() {
        document.getElementById('successModal').classList.add('hidden');
    }

    function closeDirectPaymentSuccessModal() {
        document.getElementById('directPaymentSuccessModal').classList.add('hidden');
    }

    // ZarinPal Error Handling
    function getZarinPalErrorMessage(code) {
        const errorMessages = {
            '-1': translations[currentLang]['required-field'],
            '-2': translations[currentLang]['completed-transaction'],
            '-3': translations[currentLang]['invalid-amount'],
            '-9': translations[currentLang]['validation-error'],
            '-11': translations[currentLang]['invalid-transaction'],
            '-15': translations[currentLang]['canceled-transaction'],
            '-50': translations[currentLang]['merchant-id-error'],
            '-51': translations[currentLang]['inactive-merchant'],
            '-54': translations[currentLang]['invalid-transaction'],
            '100': translations[currentLang]['success'],
            '101': translations[currentLang]['verified-transaction']
        };
        return errorMessages[code] || translations[currentLang]['unknown-error'];
    }

    // Payment processing
    async function processPayment() {
        try {
            SecurityManager.checkRateLimit();
            
            const amount = selectedAmount;
            const name = SecurityManager.sanitizeInput(document.getElementById('donorName').value);
            const email = SecurityManager.sanitizeInput(document.getElementById('donorEmail').value);
            const message = SecurityManager.sanitizeInput(document.getElementById('donorMessage').value);
            
            SecurityManager.validateAmount(amount);
            SecurityManager.validateEmail(email);
            SecurityManager.validateName(name);
            SecurityManager.validateMessage(message);
            
            if (selectedPaymentMethod === 'gateway') {
                await processGatewayPayment(amount, name, email, message);
            } else {
                await processDirectPayment(amount, name, email, message);
            }
            
        } catch (error) {
            showError(error.message);
        }
    }

    async function processGatewayPayment(amount, name, email, message) {
        try {
            if (!ZARINPAL_MERCHANT_ID || ZARINPAL_MERCHANT_ID === 'YOUR_ZARINPAL_MERCHANT_ID_HERE') {
                throw new Error(translations[currentLang]['merchant-id-required']);
            }

            const paymentData = {
                merchant_id: ZARINPAL_MERCHANT_ID,
                amount: amount * 10, // Convert to Rial
                callback_url: ZARINPAL_CALLBACK_URL,
                description: message || translations[currentLang]['support-description'],
                metadata: {
                    name: name || 'Anonymous',
                    email: email || undefined
                }
            };

            const response = await fetch('https://api.zarinpal.com/pg/v4/payment/request.json', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify(paymentData)
            });

            const result = await response.json();

            if (result.data && result.data.code === 100) {
                const authority = result.data.authority;
                document.getElementById('gatewayAmount').textContent = amount.toLocaleString('fa-IR') + ' ' + translations[currentLang]['currency'];
                document.getElementById('gatewayName').textContent = name || translations[currentLang]['anonymous'];
                document.getElementById('trackingCode').textContent = authority;
                document.getElementById('paymentGatewayModal').classList.remove('hidden');
                
                // Store payment data temporarily
                DataManager.saveData('pending_payment', {
                    authority,
                    amount,
                    name,
                    email,
                    message
                });
                
            } else {
                const errorMsg = getZarinPalErrorMessage(result.errors?.code || result.data?.code);
                throw new Error(errorMsg);
            }
            
        } catch (error) {
            throw new Error(`${translations[currentLang]['payment-error']}: ${error.message}`);
        }
    }

    async function completePayment() {
        try {
            const paymentData = DataManager.loadData('pending_payment', {});
            const authority = paymentData.authority;
            
            if (!authority) {
                throw new Error(translations[currentLang]['no-payment-session']);
            }

            const verificationData = {
                merchant_id: ZARINPAL_MERCHANT_ID,
                authority: authority,
                amount: paymentData.amount * 10 // Convert to Rial
            };

            const response = await fetch('https://api.zarinpal.com/pg/v4/payment/verify.json', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify(verificationData)
            });

            const result = await response.json();

            if (result.data && result.data.code === 100) {
                document.getElementById('paymentGatewayModal').classList.add('hidden');
                document.getElementById('successModal').classList.remove('hidden');
                
                // Update statistics
                updateStatistics(paymentData.amount, paymentData.name, paymentData.message);
                
                // Clear pending payment
                DataManager.clearData('pending_payment');
                
                // Send Telegram notification
                sendTelegramNotification(paymentData);
                
            } else {
                const errorMsg = getZarinPalErrorMessage(result.errors?.code || result.data?.code);
                throw new Error(errorMsg);
            }
            
        } catch (error) {
            throw new Error(`${translations[currentLang]['payment-error']}: ${error.message}`);
        }
    }

    function cancelPayment() {
        document.getElementById('paymentGatewayModal').classList.add('hidden');
        DataManager.clearData('pending_payment');
    }

    async function processDirectPayment(amount, name, email, message) {
        try {
            const mobile = SecurityManager.sanitizeInput(document.getElementById('directMobile').value);
            const ssn = SecurityManager.sanitizeInput(document.getElementById('directSSN').value);
            const bankCode = document.getElementById('bankSelect').value;
            const maxDailyCount = parseInt(document.getElementById('maxDailyCount').value);
            const maxMonthlyCount = parseInt(document.getElementById('maxMonthlyCount').value);
            const maxAmount = parseInt(document.getElementById('maxAmount').value.replace(/,/g, ''));

            if (!mobile || mobile.length !== 11 || !/09[0-9]{9}/.test(mobile)) {
                throw new Error(translations[currentLang]['invalid-mobile']);
            }

            if (!bankCode) {
                throw new Error(translations[currentLang]['bank-required']);
            }

            if (isNaN(maxDailyCount) || maxDailyCount < 1 || maxDailyCount > 100) {
                throw new Error(translations[currentLang]['invalid-daily-count']);
            }

            if (isNaN(maxMonthlyCount) || maxMonthlyCount < 1 || maxMonthlyCount > 1000) {
                throw new Error(translations[currentLang]['invalid-monthly-count']);
            }

            if (isNaN(maxAmount) || maxAmount < 1000 || maxAmount > 100000000) {
                throw new Error(translations[currentLang]['invalid-max-amount']);
            }

            const directPaymentData = {
                merchant_id: ZARINPAL_MERCHANT_ID,
                mobile,
                national_code: ssn || undefined,
                bank_code: bankCode,
                max_daily_count: maxDailyCount,
                max_monthly_count: maxMonthlyCount,
                max_amount: maxAmount * 10, // Convert to Rial
                description: translations[currentLang]['direct-payment-desc']
            };

            const response = await fetch(ZARINPAL_PAYMAN_REQUEST_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json',
                    'Authorization': `Bearer ${ZARINPAL_ACCESS_TOKEN}`
                },
                body: JSON.stringify(directPaymentData)
            });

            const result = await response.json();

            if (result.data && result.data.code === 100) {
                document.getElementById('contractAuthority').textContent = result.data.authority;
                document.getElementById('contractMobile').textContent = mobile;
                document.getElementById('contractBank').textContent = availableBanks.find(bank => bank.code === bankCode)?.name || bankCode;
                document.getElementById('contractMaxAmount').textContent = maxAmount.toLocaleString('fa-IR') + ' ' + translations[currentLang]['currency'];
                document.getElementById('contractDailyCount').textContent = maxDailyCount;
                document.getElementById('directPaymentSuccessModal').classList.remove('hidden');
                
                // Update statistics
                updateStatistics(amount, name, message);
                
                // Send Telegram notification
                sendTelegramNotification({
                    amount,
                    name,
                    email,
                    message,
                    authority: result.data.authority,
                    payment_type: 'direct'
                });
                
            } else {
                const errorMsg = getZarinPalErrorMessage(result.errors?.code || result.data?.code);
                throw new Error(errorMsg);
            }
            
        } catch (error) {
            throw new Error(`${translations[currentLang]['payment-error']}: ${error.message}`);
        }
    }

    async function fetchBanksList() {
        try {
            const response = await fetch(ZARINPAL_BANKS_LIST_URL, {
                headers: {
                    'Authorization': `Bearer ${ZARINPAL_ACCESS_TOKEN}`
                }
            });
            const result = await response.json();
            
            if (result.data && result.data.banks) {
                availableBanks = result.data.banks;
                const bankSelect = document.getElementById('bankSelect');
                bankSelect.innerHTML = `<option value="">${translations[currentLang]['select-bank']}</option>`;
                
                availableBanks.forEach(bank => {
                    const option = document.createElement('option');
                    option.value = bank.code;
                    option.textContent = bank.name;
                    bankSelect.appendChild(option);
                });
            } else {
                throw new Error(translations[currentLang]['banks-fetch-error']);
            }
            
        } catch (error) {
            console.error('Failed to fetch banks:', error);
            showError(translations[currentLang]['banks-fetch-error']);
        }
    }

    async function sendTelegramNotification(paymentData) {
        try {
            const message = `
🔔 ${translations[currentLang]['new-donation']}
💰 ${translations[currentLang]['amount']}: ${paymentData.amount.toLocaleString('fa-IR')} ${translations[currentLang]['currency']}
👤 ${translations[currentLang]['name']}: ${paymentData.name || translations[currentLang]['anonymous']}
📧 ${translations[currentLang]['email']}: ${paymentData.email || '-'}
💬 ${translations[currentLang]['message']}: ${paymentData.message || '-'}
📋 ${translations[currentLang]['tracking-code']}${paymentData.authority}
${paymentData.payment_type === 'direct' ? '⚡ ' + translations[currentLang]['direct-payment'] : ''}
            `;
            
            const telegramUrl = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
            
            await fetch(telegramUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    chat_id: TELEGRAM_CHAT_ID,
                    text: message,
                    parse_mode: 'Markdown'
                })
            });
            
            console.log('✅ Telegram notification sent');
            
        } catch (error) {
            console.error('Failed to send Telegram notification:', error);
        }
    }

    function updateStatistics(amount, name, message) {
        const totalAmountElement = document.getElementById('realTotalAmount');
        const totalSupportersElement = document.getElementById('realTotalSupporters');
        const headerTotalAmount = document.getElementById('headerTotalAmount');
        const headerTotalSupporters = document.getElementById('headerTotalSupporters');
        const currentAmountElement = document.getElementById('currentAmount');
        const progressPercentElement = document.getElementById('progressPercent');
        const progressBarElement = document.getElementById('progressBar');
        const averageAmountElement = document.getElementById('averageAmount');
        const todayCountElement = document.getElementById('todayCount');
        const weekCountElement = document.getElementById('weekCount');
        const monthCountElement = document.getElementById('monthCount');
        const totalCountElement = document.getElementById('totalCount');
        
        // Load current stats
        let stats = DataManager.loadData('donation_stats', {
            totalAmount: 0,
            totalSupporters: 0,
            todayCount: 0,
            weekCount: 0,
            monthCount: 0,
            totalCount: 0,
            donations: []
        });
        
        // Update stats
        stats.totalAmount += amount;
        stats.totalSupporters += 1;
        stats.todayCount += 1;
        stats.weekCount += 1;
        stats.monthCount += 1;
        stats.totalCount += 1;
        
        // Add donation to history
        stats.donations.push({
            amount,
            name: name || translations[currentLang]['anonymous'],
            message,
            timestamp: new Date().toISOString()
        });
        
        // Save updated stats
        DataManager.saveData('donation_stats', stats);
        
        // Update UI
        totalAmountElement.textContent = stats.totalAmount.toLocaleString('fa-IR') + ' ' + translations[currentLang]['currency'];
        totalSupportersElement.textContent = stats.totalSupporters.toLocaleString('fa-IR') + ' ' + translations[currentLang]['supporters'];
        headerTotalAmount.textContent = stats.totalAmount.toLocaleString('fa-IR');
        headerTotalSupporters.textContent = stats.totalSupporters.toLocaleString('fa-IR');
        currentAmountElement.textContent = stats.totalAmount.toLocaleString('fa-IR') + ' ' + translations[currentLang]['currency'];
        
        const goal = 10000000; // 10M Toman
        const progress = Math.min((stats.totalAmount / goal) * 100, 100);
        progressPercentElement.textContent = Math.round(progress) + '%';
        progressBarElement.style.width = progress + '%';
        
        const averageDonation = stats.totalSupporters > 0 ? Math.round(stats.totalAmount / stats.totalSupporters) : 0;
        averageAmountElement.textContent = averageDonation.toLocaleString('fa-IR') + ' ' + translations[currentLang]['currency'];
        
        todayCountElement.textContent = stats.todayCount.toLocaleString('fa-IR');
        weekCountElement.textContent = stats.weekCount.toLocaleString('fa-IR');
        monthCountElement.textContent = stats.monthCount.toLocaleString('fa-IR');
        totalCountElement.textContent = stats.totalCount.toLocaleString('fa-IR');
        
        // Update recent supporters
        updateRecentSupporters(stats.donations);
        
        // Update badges
        updateUserBadges(stats.totalAmount);
        
        // Add animation
        [totalAmountElement, totalSupportersElement, headerTotalAmount, headerTotalSupporters, 
         currentAmountElement, progressPercentElement, progressBarElement, averageAmountElement,
         todayCountElement, weekCountElement, monthCountElement, totalCountElement].forEach(el => {
            el.classList.add('counter-update');
            setTimeout(() => el.classList.remove('counter-update'), 600);
        });
    }

    function updateRecentSupporters(donations) {
        const recentSupporters = document.getElementById('recentSupporters');
        recentSupporters.innerHTML = '';
        
        const recentDonations = donations.slice(-5).reverse();
        
        recentDonations.forEach(donation => {
            const supporterCard = document.createElement('div');
            supporterCard.className = 'supporter-card rounded-xl p-4';
            supporterCard.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2 space-x-reverse">
                        <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-red-600 rounded-full flex items-center justify-center">
                            <span class="text-white text-lg">👤</span>
                        </div>
                        <div>
                            <div class="text-white font-semibold">${SecurityManager.escapeHtml(donation.name)}</div>
                            <div class="text-gray-400 text-xs">${new Date(donation.timestamp).toLocaleTimeString(currentLang)}</div>
                        </div>
                    </div>
                    <div class="text-green-400 font-bold">${donation.amount.toLocaleString('fa-IR')} ${translations[currentLang]['currency']}</div>
                </div>
                ${donation.message ? `
                <div class="mt-3 text-gray-300 text-sm border-t border-white/10 pt-2">
                    ${SecurityManager.escapeHtml(donation.message)}
                </div>` : ''}
            `;
            recentSupporters.appendChild(supporterCard);
        });
    }

    function updateUserBadges(totalAmount) {
        const badges = [
            { amount: 50000, name: translations[currentLang]['coffee-badge'], emoji: '☕' },
            { amount: 100000, name: translations[currentLang]['meal-badge'], emoji: '🍕' },
            { amount: 250000, name: translations[currentLang]['gift-badge'], emoji: '🎁' },
            { amount: 500000, name: translations[currentLang]['diamond-badge'], emoji: '💎' },
            { amount: 1000000, name: translations[currentLang]['millionaire-badge'], emoji: '👑' },
            { amount: 5000000, name: translations[currentLang]['astronaut-badge'], emoji: '🚀' }
        ];
        
        const userBadgesList = document.getElementById('userBadgesList');
        userBadgesList.innerHTML = '';
        
        const earnedBadges = badges.filter(badge => totalAmount >= badge.amount);
        
        if (earnedBadges.length === 0) {
            userBadgesList.innerHTML = `<div class="text-gray-400 text-sm">${translations[currentLang]['no-badges']}</div>`;
            return;
        }
        
        earnedBadges.forEach(badge => {
            const badgeElement = document.createElement('div');
            badgeElement.className = 'stats-card rounded-xl p-3 flex items-center justify-between';
            badgeElement.innerHTML = `
                <div class="flex items-center space-x-2 space-x-reverse">
                    <span class="text-xl">${badge.emoji}</span>
                    <span class="text-white text-sm">${badge.name}</span>
                </div>
                <span class="text-green-400 text-xs">✅ ${translations[currentLang]['earned']}</span>
            `;
            userBadgesList.appendChild(badgeElement);
        });
    }

    async function loadTransactionHistory() {
        if (!ZARINPAL_ACCESS_TOKEN || ZARINPAL_ACCESS_TOKEN === 'YOUR_ACCESS_TOKEN_HERE') {
            showError(translations[currentLang]['no-access-token']);
            return;
        }

        try {
            const query = `
                query {
                    transactions(terminal_id: "${ZARINPAL_TERMINAL_ID}", limit: 10) {
                        id
                        amount
                        status
                        created_at
                        card_pan
                        ref_id
                        description
                    }
                }
            `;

            const response = await fetch(ZARINPAL_GRAPHQL_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${ZARINPAL_ACCESS_TOKEN}`
                },
                body: JSON.stringify({ query })
            });

            const result = await response.json();

            if (result.data && result.data.transactions) {
                const transactionHistory = document.getElementById('transactionHistory');
                transactionHistory.innerHTML = '';
                
                result.data.transactions.forEach(tx => {
                    const transactionCard = document.createElement('div');
                    transactionCard.className = 'stats-card rounded-xl p-4';
                    transactionCard.innerHTML = `
                        <div class="flex justify-between items-center mb-2">
                            <div class="text-white font-semibold">${tx.id}</div>
                            <div class="text-green-400 font-bold">${(tx.amount / 10).toLocaleString('fa-IR')} ${translations[currentLang]['currency']}</div>
                        </div>
                        <div class="text-gray-400 text-xs mb-1">${new Date(tx.created_at).toLocaleString(currentLang)}</div>
                        <div class="text-gray-400 text-xs">${translations[currentLang]['card']}: ${tx.card_pan ? '****' + tx.card_pan.slice(-4) : '-'}</div>
                        <div class="text-gray-400 text-xs">${translations[currentLang]['ref-id']}: ${tx.ref_id || '-'}</div>
                        <div class="text-gray-400 text-xs">${translations[currentLang]['status']}: ${tx.status}</div>
                        <div class="text-gray-400 text-xs mt-2 border-t border-white/10 pt-2">${SecurityManager.escapeHtml(tx.description)}</div>
                    `;
                    transactionHistory.appendChild(transactionCard);
                });
            } else {
                throw new Error(translations[currentLang]['fetch-transactions-error']);
            }
            
        } catch (error) {
            showError(`${translations[currentLang]['fetch-transactions-error']}: ${error.message}`);
        }
    }

    async function getApplicationInfo() {
        try {
            const query = `
                query {
                    application {
                        id
                        name
                        status
                    }
                }
            `;

            const response = await fetch(ZARINPAL_GRAPHQL_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${ZARINPAL_ACCESS_TOKEN}`
                },
                body: JSON.stringify({ query })
            });

            const result = await response.json();
            return result.data?.application;
        } catch (error) {
            console.error('Failed to get application info:', error);
            return null;
        }
    }

    function showError(message) {
        document.getElementById('errorTitle').textContent = translations[currentLang]['error-title'];
        document.getElementById('errorMessage').textContent = message;
        document.getElementById('errorModal').classList.remove('hidden');
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
        loadZarinPalConfig();
        fetchBanksList();
        updateTranslations();
        
        // Reset stats daily
        setInterval(() => {
            const stats = DataManager.loadData('donation_stats', {
                totalAmount: 0,
                totalSupporters: 0,
                todayCount: 0,
                weekCount: 0,
                monthCount: 0,
                totalCount: 0,
                donations: []
            });
            
            const now = new Date();
            const lastReset = new Date(DataManager.loadData('last_reset', now.toISOString()));
            
            if (now.getDate() !== lastReset.getDate()) {
                stats.todayCount = 0;
                DataManager.saveData('donation_stats', stats);
                DataManager.saveData('last_reset', now.toISOString());
            }
            
            if (now.getDay() === 0 && now.getDate() !== lastReset.getDate()) {
                stats.weekCount = 0;
                DataManager.saveData('donation_stats', stats);
                DataManager.saveData('last_reset', now.toISOString());
            }
            
            if (now.getMonth() !== lastReset.getMonth()) {
                stats.monthCount = 0;
                DataManager.saveData('donation_stats', stats);
                DataManager.saveData('last_reset', now.toISOString());
            }
            
        }, 3600000); // Check every hour
    });

    // Additional translations for errors and statuses
    translations.fa = {
        ...translations.fa,
        'required-field': 'فیلد مورد نیاز پر نشده است',
        'completed-transaction': 'تراکنش قبلاً تکمیل شده است',
        'validation-error': 'خطای اعتبارسنجی',
        'invalid-transaction': 'تراکنش نامعتبر است',
        'canceled-transaction': 'تراکنش لغو شده است',
        'merchant-id-error': 'شناسه پذیرنده نامعتبر است',
        'inactive-merchant': 'پذیرنده غیرفعال است',
        'success': 'موفق',
        'verified-transaction': 'تراکنش تأیید شده است',
        'unknown-error': 'خطای ناشناخته',
        'payment-error': 'خطای پرداخت',
        'no-payment-session': 'جلسه پرداخت یافت نشد',
        'merchant-id-required': 'شناسه پذیرنده مورد نیاز است',
        'invalid-merchant-id': 'شناسه پذیرنده نامعتبر است',
        'invalid-access-token': 'توکن دسترسی نامعتبر است',
        'access-token-required': 'توکن دسترسی مورد نیاز است',
        'no-access-token': 'توکن دسترسی تنظیم نشده است',
        'test-connection': 'تست اتصال به درگاه',
        'connection-success': 'اتصال به درگاه با موفقیت برقرار شد',
        'full-connection-success': 'اتصال کامل با موفقیت برقرار شد',
        'connection-error': 'خطا در برقراری اتصال',
        'access-token-error': 'خطا در بررسی توکن دسترسی',
        'config-saved': 'تنظیمات با موفقیت ذخیره شد',
        'merchant-id-configured': 'شناسه پذیرنده تنظیم شده است',
        'access-token-configured': 'توکن دسترسی تنظیم شده است',
        'no-config': 'هیچ تنظیماتی انجام نشده است',
        'invalid-mobile': 'شماره موبایل نامعتبر است',
        'bank-required': 'انتخاب بانک الزامی است',
        'invalid-daily-count': 'تعداد تراکنش روزانه نامعتبر است',
        'invalid-monthly-count': 'تعداد تراکنش ماهانه نامعتبر است',
        'invalid-max-amount': 'حداکثر مبلغ تراکنش نامعتبر است',
        'banks-fetch-error': 'خطا در دریافت لیست بانک‌ها',
        'support-description': 'حمایت از پلتفرم نوآوری',
        'anonymous': 'ناشناس',
        'fetch-transactions-error': 'خطا در دریافت تاریخچه تراکنش‌ها',
        'card': 'کارت',
        'ref-id': 'شماره ارجاع',
        'earned': 'کسب شده',
        'new-donation': 'حمایت جدید',
        'select-bank': 'انتخاب بانک'
    };

    translations.en = {
        ...translations.en,
        'required-field': 'Required field is missing',
        'completed-transaction': 'Transaction already completed',
        'validation-error': 'Validation error',
        'invalid-transaction': 'Invalid transaction',
        'canceled-transaction': 'Transaction canceled',
        'merchant-id-error': 'Invalid merchant ID',
        'inactive-merchant': 'Inactive merchant',
        'success': 'Success',
        'verified-transaction': 'Transaction verified',
        'unknown-error': 'Unknown error',
        'payment-error': 'Payment error',
        'no-payment-session': 'No payment session found',
        'merchant-id-required': 'Merchant ID is required',
        'invalid-merchant-id': 'Invalid Merchant ID',
        'invalid-access-token': 'Invalid Access Token',
        'access-token-required': 'Access Token is required',
        'no-access-token': 'Access Token not set',
        'test-connection': 'Test Gateway Connection',
        'connection-success': 'Successfully connected to gateway',
        'full-connection-success': 'Full connection established successfully',
        'connection-error': 'Connection error',
        'access-token-error': 'Error validating access token',
        'config-saved': 'Configuration saved successfully',
        'merchant-id-configured': 'Merchant ID configured',
        'access-token-configured': 'Access Token configured',
        'no-config': 'No configuration set',
        'invalid-mobile': 'Invalid mobile number',
        'bank-required': 'Bank selection is required',
        'invalid-daily-count': 'Invalid daily transaction count',
        'invalid-monthly-count': 'Invalid monthly transaction count',
        'invalid-max-amount': 'Invalid maximum transaction amount',
        'banks-fetch-error': 'Error fetching banks list',
        'support-description': 'Support for Innovation Platform',
        'anonymous': 'Anonymous',
        'fetch-transactions-error': 'Error fetching transaction history',
        'card': 'Card',
        'ref-id': 'Reference ID',
        'earned': 'Earned',
        'new-donation': 'New Donation',
        'select-bank': 'Select Bank'
    };

    translations.zh = {
        ...translations.zh,
        'required-field': '缺少必填字段',
        'completed-transaction': '交易已完成',
        'validation-error': '验证错误',
        'invalid-transaction': '无效交易',
        'canceled-transaction': '交易已取消',
        'merchant-id-error': '无效的商户ID',
        'inactive-merchant': '商户未激活',
        'success': '成功',
        'verified-transaction': '交易已验证',
        'unknown-error': '未知错误',
        'payment-error': '支付错误',
        'no-payment-session': '未找到支付会话',
        'merchant-id-required': '需要商户ID',
        'invalid-merchant-id': '无效的商户ID',
        'invalid-access-token': '无效的访问令牌',
        'access-token-required': '需要访问令牌',
        'no-access-token': '未设置访问令牌',
        'test-connection': '测试网关连接',
        'connection-success': '成功连接到网关',
        'full-connection-success': '完整连接建立成功',
        'connection-error': '连接错误',
        'access-token-error': '验证访问令牌错误',
        'config-saved': '配置保存成功',
        'merchant-id-configured': '已配置商户ID',
        'access-token-configured': '已配置访问令牌',
        'no-config': '未设置任何配置',
        'invalid-mobile': '无效的手机号码',
        'bank-required': '必须选择银行',
        'invalid-daily-count': '无效的每日交易次数',
        'invalid-monthly-count': '无效的每月交易次数',
        'invalid-max-amount': '无效的最大交易金额',
        'banks-fetch-error': '获取银行列表错误',
        'support-description': '支持创新平台',
        'anonymous': '匿名',
        'fetch-transactions-error': '获取交易历史错误',
        'card': '银行卡',
        'ref-id': '参考ID',
        'earned': '已获得',
        'new-donation': '新捐款',
        'select-bank': '选择银行'
    };
</script>
</body>
</html>